pipeline {
  agent any
  parameters {
    string(description: 'enter ami_id', name: 'AMI_ID')
    string(description: 'enter subnet id', name: 'SUBNET')
    string(description: 'enter region name', name: 'REGION')
    string(description: 'enter Key name', name: 'TAG_KEY')
    string(description: 'enter Key-value-name', name: 'TAG_VALUE')
    string(description: 'enter instance-type', name: 'INSTANCE_TYPE')
    string(description: 'enter security-group-id', name: 'SECURITY_GROUP_ID')
    choice(choices: ['CI_VPC', 'test1'], description: 'choose key pair?', name: 'KEYPAIR')
  }
  stages {
    stage('build') {
      steps {
        withCredentials([[
          $class: 'AmazonWebServicesCredentialsBinding',
          credentialsId: 'aws-access',
          accessKeyVariable: 'AWS_ACCESS_KEY_ID',
          secretKeyVariable: 'AWS_SECRET_ACCESS_KEY'
        ]])       
        {
          git url: 'https://github.com/usman6745/client-aws-instance-launch1.git'
          sh '''
          chmod +x properfunc.sh
            ./properfunc.sh $AMI_ID $KEYPAIR $SUBNET $REGION $TAG_KEY $TAG_VALUE $INSTANCE_TYPE $SECURITY_GROUP_ID
        ''' 
      }
    }
    }
 stage('slacknotification') {
 steps{      
 slackSend baseUrl: 'https://opstree.slack.com/services/hooks/jenkins-ci/',
 channel: 'ot-meesho',
 color: 'good',
 message: 'Jenkins-Slack Intigrated Instance-id is Launched - The Instance ID is "${id}"',
 teamDomain: 'opstree',
 tokenCredentialId: 'slack-token'
 }
 }
     //stage('emailnotification') {
     //steps{
     //emailext attachLog: true, body: 'Hello, this is a test mail', subject: 'Email-Push', to: 'usman.mohammed@opstree.com'
     //}
     //}
                                  // stage('email-extended') {
                                //   steps{
                              
}

//post {
  //                                    always {
    //                                  script {
      //                                if (currentBuild.currentResult == 'SUCCESS') { // Other values: SUCCESS, UNSTABLE
                                      ////// Send an email only if the build status has changed from green/unstable to red
        //                              emailext subject: '$DEFAULT_SUBJECT',
          //                            body: '$DEFAULT_CONTENT',
            //                          replyTo: '$DEFAULT_REPLYTO',
              //                        to: '$DEFAULT_RECIPIENTS'
                                   //        }
                                     //     }
                                      //}
                                 // }
                                 // }
                                  //}


}
